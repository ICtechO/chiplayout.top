---
date: 2010-11-24 07:54:36
title: match of layout(版图中的匹配)
createTime: 2010-11-23T23:54:36.000Z
permalink: /Layout/lbj0j
categories:
  - Layout
tags:
  - 匹配
  - 版图
coverImg: https://img.onedayxyy.cn/images/TeekCover/3.webp
---

 

主要工作注意事项

## 一.画之前的准备工作 
  1. 先估算芯片面积：先分别计算各个电路模块的面积，然后再加上模块之间走线以及端口引出等的面积，即得到总的芯片面积。 
  2. Top－Down设计流程： 先根据电路规模对版图进行整体布局，芯片的整体布局包括主要单元的形状大小以及位置安排，电源和地的布局，输入输出引脚的放置等，统计整体芯片的引脚个数，包括测试点也要确定好，严格确定每个模块的引脚属性、位置 。 
  3. 详细的整体布局的考虑因素 
    - a. 模块的放置应该与信号的流向一致 ，每个模块一定按照确定好的引脚位置引出自己的连线 
    - b. 保证主信号信道简单通畅，连线尽量短、少拐弯、等长 
    - c. 不同模块的电源、地分开，以防干扰 ，电源线的寄生电阻尽可能减小，避免各模块的电源电压不一致。 
    - d. 尽可能把电容、电阻和大管子放在侧旁，利于提高电路的抗干扰能力。 
## 二.与circuit designer沟通 
1. 目的：搞清楚电路的结构和工作原理 ，明确电路设计中对版图有特殊要求的地方（可能出现问题的地方）。 
2. 包含内容： 
  - a.确保金属线的宽度和引线孔的数目能够满足要求（各通路的电流在典型情况和最坏情况的大小），尤其是电源线和地线的宽度。 
  - b.差分对管、有源负载、电流镜、电容阵列、电阻阵列等要求匹配良好的子模块 
  - c.电路中MOS管、电阻、电容对精度的要求 d.易受干扰的电压传输线 、高频信号传输线 
## 三.layout的金属线尤其是电源线、地线
1. 根据电路在最坏情况下的电流值来决定金属线的宽度以及接触孔的排列方式和数目，以避免电迁移。 电迁移效应：所谓电迁移效应是指当传输电流过大时，电子碰撞金属原子，导致原子移位而使金属断线。 在接触孔周围，电流比较集中，电迁移效应更加容易发生。 
2. 避免天线效应 天线效应——长金属线（面积较大的金属线）在刻蚀的时候，会吸引大量的电荷（因为工艺中刻蚀金属是在强场中进行的），这时如果该金属直接与管子栅（相当于有栅电容）相连的话，可能会在栅极形成高电压会影响栅极氧化层的质量，降低电路的可靠性和寿命。 天线效应的解决方法：用另外一层更高一层的金属来割断本层的大面积金属，如下图所示。 

![slide0010_image010](/public/2011/08/slide0010_image0101.png)

3. 芯片金属线存在寄生电阻和寄生电容效应 寄生电阻会使电压产生漂移，导致额外噪声的产生； 寄生电容耦合会使信号之间互相干扰。 
  - 关于寄生电阻：
    - a.镜像电流源内部的晶体管在版图上应该放在一起 ， 然后通过连线引到各个需要供电的模块 。
    - b.加粗金属线
    - c.存在对称关系的信号的连线也应该保持对称，使得信号线的寄生电阻保持相等 。

![slide0021_image012](/public/2011/08/slide0021_image0121.png) ![slide0021_image014](/public/2011/08/slide0021_image0141.png)

  - 关于寄生电容
    - a.避免时钟线与信号线的重叠
    - b.两条信号线应该避免长距离平行，信号线之间交叉对彼此的影响比二者平行要小；
    - c.输入信号线和输出信号线应该避免交叉；
    - d.对于易受干扰的信号线，在两侧加地线保护；
    - e.模拟电路的数字部分，需要严格隔离开。 

## 四.保护环
1. 避免闩锁效应：最常见的Latchup诱因是电源、地的瞬态脉冲 ，这种瞬态脉冲可能的产生原因是瞬时电源中断等，它可能会使引脚电位高于vdd或低于vss，容易发生latchup。因此对于电路中有连接到电源或地的MOS管，周围需要加保护环。

2. 容易发生latchup的地方：任何不与power supply、substrate相连的引脚都可能。所以精度要求高时，要查看是否有引脚引线既不连power supply，也不连substrate，凡是和这样的引线相连的源区、漏区都要接保护环。

3. 保护环要起到有效的作用就应该使保护环宽度较宽、电阻较低，而且用深扩散材料 。

4. N管的周围应该加吸收少子电子的N型保护环（ntap），ntap环接vdd；P管的周围应该加吸收少子空穴的P型保护环（ptap），ptap环接gnd。双环对少子的吸收效果比单环好 。下图是一个N管保护环的例子。

![slide0012_image017](/public/2011/08/slide0012_image0171.gif)

## 五.衬底噪声
1. 衬底噪声产生原因：源、漏-衬底pn结正偏导通，或者电源连线接点引入的串绕，使得衬底电位会产生抖动偏差，这称为衬底噪声。

2. 解决方法：
  - a.对于轻掺杂的衬底，要用保护环把敏感部分电路包围起来
  - b.把gnd和衬底在片内连在一起，然后由一条线连到片外的全局地线,使得gnd和衬底的跳动一致，也可以消除衬底噪声 。
  - c.场屏蔽作用：每个block外围一层金属（ptap），使每单元模块同电势 ，而且模块之间不相互影响。
3. 衬底可靠电位的连接：
  - a.尽量把衬底与电源的接触穿孔（substrate contact）的位置和该位置的管子的衬底注入极（substrate injector）的距离缩小，距离越近越好 ，因为这种距离的大小对衬底电位偏差影响非常大。
  - b.把衬底接触孔的数量增多，尽量多打孔 ，保证衬底与电源的接触电阻较小。 

## 六.管子的匹配精度
1. 电流成比例关系的MOS管，应使电流方向一致，版图中晶体管尽量同向 ，开关管可以忽略。
2. 配置dummy器件，使版图周边条件一致，结构更加对称。下图是dummy电容的使用。dummy器件的配置：为了使得器件B周边的电特性比较一致 ，会在版图中加入dummy cell（如图4中右边的电容），尽管它在电路中是多余的。 

![slide0014_image019](/public/2011/08/slide0014_image0191.gif)

3. 在处理匹配性要求高的对管（如差分输入对管）时，采用交叉对称的结构比较好 。下图为晶体管交叉对称 。

![slide0015_image020](/public/2011/08/slide0015_image0201.png) 
![slide0015_image022](/public/2011/08/slide0015_image0221.png)

4. MOS器件的匹配主要有四方面影响因素：
- 栅面积：匹配度与有源区面积（S=WL）成反比关系。
- 栅氧化层厚度：一般薄栅氧化层的管子的匹配度较高；
- 沟道长度调制：管子的不匹配与VGS的不匹配成正比，与沟道长度成反比；
- 方向（orientation）：沿晶体不同轴向制作的管子的迁移率不同，这就会影响管子跨导的匹配度；把需要匹配的一组管子放在一个cell中 ，避免因旋转cell而产生的方向不匹配 。
- dummy器件的详细讲述： 如果周边环境不同，会使工艺中的刻蚀率不同，
  比如：线宽大，刻蚀率大，刻蚀的快。刻蚀的快慢会影响线电阻等电学参数。
  例子： 尺寸较大的管子被拆成小管子并联时，要在两端的小管的栅旁加上dummy gate，这样可以保证比较精确的电流匹配。
  而且这种dummy gate的宽度可以比实际的栅宽小。各个小管子的gate 最好用metal联起来，如果用poly连会引起刻蚀率的偏差。

![slide0018_image024](/public/2011/08/slide0018_image0241.png)

6. 主要单元电路的匹配：差分对的管子位置和连线长短都要对称，能合为一条线的连线就要合；差分对主要使VGS匹配，而电流镜主要使ID匹配 。

7. MOS匹配的几点注意：
  - a. contact孔、metal走线不要放在有源区内 ，如果metal一定要跨过有源区的话，就应该加入dummy 走线。
  - b.最好把匹配管子放在远离深扩散边缘的地方，至少要两倍结深。N-well属于深扩散，PMOS也要放在阱内距离阱边较远处。
  - c.尽量使用NMOS管来作匹配管，因为NMOS比PMOS更易达到匹配 。
  - d.为避免由gradient引起的mismatch，采用conmmon-centroid layout同心结构，且尽量紧密 ，差分对可用cross-coupled pairs结构。
  - e.匹配器件要远离功率器件摆放， 功耗大于50mw的就属于功率器件。

8. 大功率供电的版图及W、L比较大的器件的版图
  - （1）W较大的管子应拆成小单元并联 ，拆成多少个单元。原则是：每个单元的电阻要小于所有单元连起来后的总的 。
  - （2）如果拆成的单元数过多，应分两排摆放 。
  - （3）大功率供电：一般问题出现在有大电流的地方，避免电迁移。

9. 电源线、地线、信号线的布线
  -  不同电路的电源线和地线之间会有一些噪声影响，比如模拟电路和数字电路的电源和地线，还有一些敏感电路的电源线、地线。这就需要把他们保护起来，保证它们不互相影响。
  - 数字电路和模拟电路的gnd要分开。
  - 信号线的布线 ： 如果两条信号线的走向平行，平行线间的寄生电容会把两个信号耦合，产生噪声。 两临近信号线上的信号相互影响称为串绕（crosstalk）。
    - 减少串绕的方法 ：采用差分结构把crosstalk化为共模扰动 。 
    - 对敏感信号线进行保护 ，方法：把敏感信号线屏蔽起来。例如：在模拟信号线的两边用同层金属画两条地线，这就对该信号线进行了横向平面的保护。将敏感电路部分与易产生噪声的地方（如：衬底注入极）间距加大。
  - 地线、电源线上尽量多的打孔，以保证P型衬底良好接地和Nwell的良好接触。

## 七.一般性注意事项
1. Grid网格的大小不宜随意改动 。
2. 引线孔千万不要叠在一起 ，应该并排放在一起 ，影响成品率 。
3. 走线相接触的地方，最好是overlap 一下，以保证良好接触 。
4. 不要处处要求最小尺寸，应该略有冗余。
5. 引脚的命名需要规范化，尽量都用英文字母 。
6. 走线尽量多用M3、M4（电流承受能力强，电阻率小） 。
